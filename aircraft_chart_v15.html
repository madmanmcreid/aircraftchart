
<!DOCTYPE html>
<meta charset="utf-8">
<title>Airbus And Boeing Passenger Aircraft Comparison</title>
<style>
  :root { --legend-w: 320px; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 16px; }
  .container { max-width: 1400px; margin: 0 auto; }
  #wrap { display: grid; grid-template-columns: minmax(0, 1fr) var(--legend-w); gap: 12px; align-items: start; }
  #legends { position: sticky; top: 12px; }
  .panel { border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
  h2 { margin: 0 0 8px 0; }
  h3 { margin: 8px 0; font-size: 15px; }
  .legend-section { margin-bottom: 12px; }
  .legend-list { display: grid; grid-template-columns: 1fr; gap: 6px; max-height: 240px; overflow: auto; padding-right: 6px; }
  .legend-item { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 4px 6px; border-radius: 6px; }
  .legend-item:hover { background: #f3f4f6; }
  .legend-item.active { outline: 2px solid #2563eb33; background: #eff6ff; }
  .swatch { width: 16px; height: 16px; border-radius: 9999px; border: 2px solid #111; background: none; }
  .swatch.dashed { border-style: dashed; }
  .swatch.solid { border-style: solid; }
  .swatch.color-airbus { border-color: #1f77b4; }
  .swatch.color-boeing { border-color: #d62728; }
  .swatch.engines::after { content: attr(data-eng); font-size: 10px; display: inline-block; transform: translate(1px,-1px); }
  .tip { position: absolute; pointer-events: none; padding: 6px 8px; background: white; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; box-shadow: 0 6px 16px rgba(0,0,0,.08); opacity: 0; }
  .controls { display:flex; gap:8px; align-items:center; margin:4px 0 6px; flex-wrap: wrap; }
  button { padding:6px 10px; border:1px solid #d1d5db; border-radius:6px; background:#f9fafb; cursor:pointer; }
  button:hover { background:#f3f4f6; }
  #chart { width: 100%; height: 680px; }
  .label { font-size: 10px; pointer-events: none; paint-order: stroke fill; stroke: rgba(255,255,255,0.9); stroke-width: 3px; }
  .footnote { color:#555; font-size:12px; text-align:center; margin-top:6px; }
  .empty { color:#6b7280; font-size:14px; margin-top:12px; }
</style>

<div class="container">
  <div id="wrap">
    <div id="vis" class="panel">
      <h2>Airbus And Boeing Passenger Aircraft Comparison</h2>
      <div class="controls">
        <button id="toggle-labels">Toggle labels</button>
        <button id="reset-zoom">Reset zoom</button>
        <button id="download-svg">Download SVG</button>
        <button id="download-png">Download PNG</button>
      </div>
      <svg id="chart" preserveAspectRatio="xMinYMin meet"></svg>
      <div class="footnote">Note: Marker diameter represents cabin width.</div>
      <div id="empty" class="empty" style="display:none">No data loaded. Make sure <code>aircraft_data.json</code> is in the same folder.</div>
    </div>

    <div id="legends" class="panel">
      <h3>Highlight / Filter</h3>
      <div class="legend-section" id="legend-manufacturer">
        <h3>Manufacturer</h3>
        <div class="legend-list" id="list-manufacturer"></div>
      </div>
      <div class="legend-section" id="legend-bodytype">
        <h3>Body Type</h3>
        <div class="legend-list" id="list-bodytype"></div>
      </div>
      <div class="legend-section" id="legend-engines">
        <h3>Engines</h3>
        <div class="legend-list" id="list-engines"></div>
      </div>
      <div class="legend-section" id="legend-family">
        <h3>Family</h3>
        <div class="legend-list" id="list-family"></div>
      </div>
    </div>
  </div>
</div>

<div class="tip" id="tip"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const longest = 20037;

fetch('aircraft_data.json')
  .then(r => r.json())
  .then(data => Array.isArray(data) ? data : [])
  .then(data => { if (data.length) buildChart(data); else showEmpty(); })
  .catch(() => showEmpty());

function showEmpty() {
  document.getElementById('empty').style.display = 'block';
}

function buildChart(data) {
  const colorStroke = d3.scaleOrdinal().domain(["Airbus","Boeing"]).range(["#1f77b4","#d62728"]);
  const colorLabel  = d3.scaleOrdinal().domain(["Airbus","Boeing"]).range(["#0e4e88","#a32020"]);

  const svg = d3.select("#chart");
  function size() { const r = svg.node().getBoundingClientRect(); return {width:r.width, height:r.height}; }

  function build() {
    svg.selectAll("*").remove();
    const {width, height} = size();
    const margin = { top: 50, right: 40, bottom: 60, left: 70 };
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;

    const root = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    root.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width", innerWidth).attr("height", innerHeight);

    const yMax = d3.max(data, d => d["Max Pax"]);
    const x = d3.scaleLinear().domain([0, longest]).range([0, innerWidth]);
    const y = d3.scaleLinear().domain([0, yMax * 1.06]).range([innerHeight, 0]).nice();
    const r = d3.scaleLinear().domain(d3.extent(data, d => d["Cabin Width (m)"])).range([4, 20]);

    const gx = root.append("g").attr("transform", "translate(0," + innerHeight + ")").call(d3.axisBottom(x));
    const gy = root.append("g").call(d3.axisLeft(y));

    root.append("text").attr("x", innerWidth/2).attr("y", innerHeight + 45).attr("text-anchor","middle").text("Range (km)");
    root.append("text").attr("x", -innerHeight/2).attr("y", -50).attr("transform","rotate(-90)").attr("text-anchor","middle").text("Max Passenger Capacity");

    const plot = root.append("g").attr("clip-path","url(#clip)");

    const gcx = x(longest);
    const greatCircleGroup = plot.append("g");
    greatCircleGroup.append("line").attr("x1",gcx).attr("x2",gcx).attr("y1",0).attr("y2",innerHeight).attr("stroke","#aaa").attr("stroke-width",1.5).attr("stroke-dasharray","3 4");
    greatCircleGroup.append("text").attr("transform", "translate(" + (gcx - 6) + "," + (innerHeight/2) + ") rotate(-90)").attr("text-anchor","middle").attr("fill","#999").text("Longest theoretical great-circle distance");

    const tip = d3.select("#tip");
    function showTip(event, d) {
      tip.style("opacity", 1).html("<strong>" + d.Manufacturer + "</strong> " + d.Model + "<br/>Range: " + d["Max Range (km)"] + " km<br/>Max pax: " + d["Max Pax"])
        .style("left", (event.pageX + 10) + "px").style("top", (event.pageY - 28) + "px");
    }
    function hideTip() { tip.style("opacity", 0); }

    const dots = plot.selectAll("circle.dot").data(data).join("circle")
      .attr("class","dot")
      .attr("cx", d => x(d["Max Range (km)"]))
      .attr("cy", d => y(d["Max Pax"]))
      .attr("r", d => r(d["Cabin Width (m)"]))
      .attr("fill","none")
      .attr("stroke", d => colorStroke(d["Manufacturer"]))
      .attr("stroke-width",2)
      .attr("stroke-dasharray", d => d["Body Type"] === "Wide" ? "0" : "4 4")
      .on("mousemove", showTip)
      .on("mouseout", hideTip);

    let labelsVisible = true;
    const labels = plot.selectAll("text.label").data(data).join("text")
      .attr("class","label")
      .attr("text-anchor","middle")
      .attr("dominant-baseline","middle")
      .attr("fill", d => colorLabel(d["Manufacturer"]))
      .text(d => d.Model);

    function position(zx, zy) {
      const useX = zx || x, useY = zy || y;
      labels.attr("x", d => useX(d["Max Range (km)"])).attr("y", d => useY(d["Max Pax"]));
    }
    position();

    document.getElementById("toggle-labels").onclick = () => {
      labelsVisible = !labelsVisible;
      labels.style("display", labelsVisible ? null : "none");
    };

    const zoom = d3.zoom().scaleExtent([0.8, 12]).translateExtent([[0,0],[innerWidth, innerHeight]]).extent([[0,0],[innerWidth, innerHeight]]).on("zoom", (event) => {
        const zx = event.transform.rescaleX(x);
        const zy = event.transform.rescaleY(y);
        gx.call(d3.axisBottom(zx));
        gy.call(d3.axisLeft(zy));
        dots.attr("cx", d => zx(d["Max Range (km)"])).attr("cy", d => zy(d["Max Pax"]));
        const ngcx = zx(longest);
        greatCircleGroup.select("line").attr("x1", ngcx).attr("x2", ngcx);
        greatCircleGroup.select("text").attr("transform", "translate(" + (ngcx - 6) + "," + (innerHeight/2) + ") rotate(-90)");
        position(zx, zy);
    });

    const zoomRect = plot.append("rect").attr("id","zoom-rect").attr("width", innerWidth).attr("height", innerHeight).style("fill","none").style("pointer-events","all").lower().call(zoom);
    document.getElementById("reset-zoom").onclick = () => { d3.select("#zoom-rect").call(zoom.transform, d3.zoomIdentity); position(); };

    const selected = { manufacturer: new Set(), bodytype: new Set(), engines: new Set(), family: new Set() };
    function applyHighlight() {
      function match(d) {
        const okM = selected.manufacturer.size ? selected.manufacturer.has(d.Manufacturer) : true;
        const okB = selected.bodytype.size ? selected.bodytype.has(d["Body Type"]) : true;
        const okE = selected.engines.size ? selected.engines.has(String(d.Engines)) : true;
        const okF = selected.family.size ? selected.family.has(d.Family) : true;
        return okM && okB && okE && okF;
      }
      dots.attr("opacity", d => match(d) ? 1 : 0.15).attr("stroke-width", d => match(d) ? 3 : 1.5);
      labels.attr("opacity", d => match(d) ? 1 : 0.15);
    }

    function buildLegend(listId, values, formatter, selectSet, makeSwatch) {
      const wrap = d3.select(listId);
      const items = wrap.selectAll("div.legend-item").data(values, d => d).join(enter => enter.append("div").attr("class","legend-item"));
      items.html("");
      items.each(function(d) {
        const row = d3.select(this);
        if (makeSwatch) row.append("span").attr("class","swatch").attr("data-eng", d);
        row.append("span").text(formatter ? formatter(d) : d);
      });
      if (makeSwatch) { items.select(".swatch").each(function(d) { const s = d3.select(this); makeSwatch(s, d); }); }
      items.on("click", function(event, d) {
        const multi = event.shiftKey;
        if (selectSet.has(d)) { if (!multi) { selectSet.clear(); } else { selectSet.delete(d); } }
        else { if (!multi) { selectSet.clear(); } selectSet.add(d); }
        items.classed("active", node => selectSet.has(node));
        applyHighlight();
        event.stopPropagation();
      });
    }

    const manufacturers = Array.from(new Set(data.map(d => d.Manufacturer))).sort();
    const bodytypes = Array.from(new Set(data.map(d => d["Body Type"]))).sort();
    const engines = Array.from(new Set(data.map(d => String(d.Engines)))).sort((a,b)=>+a-+b);
    const families = Array.from(new Set(data.map(d => d.Family))).sort();

    buildLegend("#list-manufacturer", manufacturers, d => d, selected.manufacturer, (sw, d) => { sw.classed("color-airbus", d === "Airbus"); sw.classed("color-boeing", d === "Boeing"); });
    buildLegend("#list-bodytype", bodytypes, d => d, selected.bodytype, (sw, d) => { sw.classed(d === "Wide" ? "solid" : "dashed", true); sw.style("border-color", "#6b7280"); });
    buildLegend("#list-engines", engines, d => d + " engines", selected.engines, (sw, d) => { sw.classed("engines", true).attr("data-eng", d); sw.style("border-color", "#6b7280"); });
    buildLegend("#list-family", families, d => d, selected.family, (sw, d) => { sw.style("border-color", "#6b7280"); });

    d3.select("body").on("click", function(event) {
      const inside = event.target.closest ? event.target.closest(".legend-item") : null;
      if (!inside) { selected.manufacturer.clear(); selected.bodytype.clear(); selected.engines.clear(); selected.family.clear(); d3.selectAll(".legend-item").classed("active", false); applyHighlight(); }
    });

    document.getElementById("download-svg").onclick = () => {
      const serializer = new XMLSerializer();
      const source = serializer.serializeToString(svg.node());
      const blob = new Blob([source], {type: "image/svg+xml;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "aircraft_chart.svg"; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    };

    document.getElementById("download-png").onclick = () => {
      const serializer = new XMLSerializer();
      const source = serializer.serializeToString(svg.node());
      const svgBlob = new Blob([source], {type: "image/svg+xml;charset=utf-8"});
      const url = URL.createObjectURL(svgBlob);
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement("canvas");
        canvas.width = width; canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,width,height);
        ctx.drawImage(img, 0, 0, width, height);
        URL.revokeObjectURL(url);
        canvas.toBlob((blob) => {
          const a = document.createElement("a");
          const pngUrl = URL.createObjectURL(blob);
          a.href = pngUrl; a.download = "aircraft_chart.png";
          document.body.appendChild(a); a.click(); document.body.removeChild(a);
          URL.revokeObjectURL(pngUrl);
        });
      };
      img.src = url;
    };
  }

  build();
  window.addEventListener("resize", () => { build(); });
}
</script>
